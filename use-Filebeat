## Cài đặt và cấu hình filebeat để gửi log đến Logstash 


### 1. Beats là gì ?

#### filebeat hoạt động như thế nào ?

### 2. Cài đặt filebeat từ client CentOS vè ELLK Stack 

add repo :
```
cat > /etc/yum.repos.d/elastic.repo << EOF
[elasticsearch-6.x]
name=Elasticsearch repository for 6.x packages
baseurl=https://artifacts.elastic.co/packages/6.x/yum
gpgcheck=1
gpgkey=https://artifacts.elastic.co/GPG-KEY-elasticsearch
enabled=1
autorefresh=1
type=rpm-md
EOF
```

Cài đặt filebeat :
yum install filebeat-6.2.4 -y 

backup cấu hình của filebeat:
```
cp /etc/filebeat/filebeat.yml /etc/filebeat/filebeat.yml.orig
rm -rf /etc/filebeat/filebeat.yml
touch /etc/filebeat/filebeat.yml
```

Sửa file cấu hình của filebeat tại /etc/filebeat/filebeat.yml như sau :

```
cat > /etc/filebeat/filebeat.yml << EOF
filebeat.inputs:
- type: log
  paths:
    - /var/log/*.log
registry_file: /var/lib/filebeat/registry

output.logstash:
    hosts: ["172.27.100.30:5044"]
    worker: 2
    bulk_max_size: 2048
logging:
to_syslog: false
to_files: true
files:
    path: /var/log/filebeat
    name: filebeat
    rotateeverybytes: 1048576000 # = 1GB
    keepfiles: 7
selectors: ["*"]
level: info
EOF
```

Khởi dộng lại filebeat


### Cấu hình Logstash trên Server


Tạo file config của logstash để thiết lập input và output 

> touch /etc/logstash/conf.d/02-logstash.conf

Thêm vào file cấu hình `  /etc/logstash/conf.d/02-logstash.conf ` nộidung :
```
input {
beats {
    port => 5044
    ssl => false
}
}

output {
    elasticsearch {
    hosts => ["localhost:9200"]
    sniffing => true
    index => "%{[@metadata][beat]}-%{+YYYY.MM.dd}"
    }
}

```
Lên Kibana kiểm  tra xem log đã được đẩy lên hay chưa 

===============( bản draw )=================
